<html>



<body>


    <span id="connection_status"></span>

    <ul id="auctions">
    </ul>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
        integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>


    <script>

        //const socket = new WebSocket('ws://localhost:12251/getAuctions');

        var socket = io('http://localhost:9090', {
            transports: ['websocket']
        });

        

        var auctions_data = [];

        socket.emit('getAuctions', null);

        socket.on('auctionData', (data) => {

            auctions_data = data;

            $.each(auctions_data.auctions, function (i, item) {

                var start_ts = moment.unix(auctions_data.time_stamp);
                var end_ts = moment(item.edate, "YYYY/MM/DD H:mm:ss");
                var duration = moment.duration(end_ts.diff(start_ts));
                var remainT = moment.utc(duration.as('milliseconds')).format("DD:HH:mm:ss")

                var html = '<li> ' + item.name;
                html += ' <span id="time_' + i + '">' + remainT + '</span>';
                html += '</li>';

                $("#auctions").append(html);
            });

            window.setInterval(function () {


                var new_date = moment.unix(auctions_data.time_stamp).add(1, 'seconds');
                auctions_data.time_stamp = new_date.unix();

                updateData();
            }, 1000);


        });


        function updateData() {


            $.each(auctions_data.auctions, function (i, item) {

                var start_ts = moment.unix(auctions_data.time_stamp);
                var end_ts = moment(item.edate, "YYYY/MM/DD H:mm:ss");
                var duration = moment.duration(end_ts.diff(start_ts));
                var remainT = moment.utc(duration.as('milliseconds')).format("DD:HH:mm:ss");

                //alert(("#time_" + i));
                $("#time_" + i).html(remainT);
            });
        }

    </script>

</body>




</html>