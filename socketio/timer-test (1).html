<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>


<body>

<div> 
    <span id="connection_status"></span>



    <!-- <ul id="auctions">
   <li class="list-group-item"><span>Products</span><span style="padding-left: 200px;">Remaining time</span></li>
    </ul> -->
<table class="table">   
    
    <div id="auctions"></div>

</table>
</div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
        integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>


    <script>

        //const socket = new WebSocket('ws://localhost:12251/getAuctions');

        var socket = io.connect('http://13.71.0.155:12251' , {
            transports: ['websocket']
        });

        

        var auctions_data = [];

        socket.emit('getAuctions', null);

        socket.on('auctionData', (data) => {

            auctions_data = data;

            $.each(auctions_data.auctions, function (i, item) {

                var start_ts = moment.unix(auctions_data.time_stamp);
                var end_ts = moment(item.edate, "YYYY/MM/DD H:mm:ss");
                var duration = moment.duration(end_ts.diff(start_ts));
                var remainT = moment.utc(duration.as('milliseconds')).format("DD:HH:mm:ss")

                //  var  htmls = '<tr>';
                //     // html += '<tr> <th>Month</th> <th>Savings</th> <th>Savings</th> <th>Savings</th> <th>Savings</th></tr>'
                //     htmls +=  '<td>'+item.name+'</td>';
                //     htmls += '<td>'+remainT +'</td>';
                //     htmls += remainT;
                //     htmls += '</tr>';
                // html += ' <tr id="time_' + i + '">' + remainT + '</tr>';
                
                        

                var html = '<li class="list-group-item"> ' +' <span class="badge badge-danger" style = "margin-right:200px;" id="time_' + i + '">' +  remainT + '</span>' ;
                    html +=  '<span>' + item.startbid+ '</span>'

                html +=   item.name ;
                html += '</li>';

                $("#auctions").append(html);
                // $("#table").append(htmls);

            });

            window.setInterval(function () {


                var new_date = moment.unix(auctions_data.time_stamp).add(1, 'seconds');
                auctions_data.time_stamp = new_date.unix();

                updateData();
            }, 1000);


        });


        function updateData() {


            $.each(auctions_data.auctions, function (i, item) {

                var start_ts = moment.unix(auctions_data.time_stamp);
                var end_ts = moment(item.edate, "YYYY/MM/DD H:mm:ss");
                var duration = moment.duration(end_ts.diff(start_ts));
                var remainT = moment.utc(duration.as('milliseconds')).format("DD:HH:mm:ss");

                //alert(("#time_" + i));
                $("#time_" + i).html(remainT);
            });
        }

    </script>

</body>




</html>